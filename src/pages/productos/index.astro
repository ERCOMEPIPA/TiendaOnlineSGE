---
export const prerender = false;

import PublicLayout from "../../layouts/PublicLayout.astro";
import ProductFilters from "../../components/islands/ProductFilters";
import { supabase } from "../../lib/supabase";

// Fetch all products
const { data: products } = await supabase
    .from("products")
    .select("*")
    .order("created_at", { ascending: false });

// Fetch categories for filter
const { data: categories } = await supabase
    .from("categories")
    .select("*")
    .order("name");

const allProducts = products || [];
const allCategories = categories || [];
---

<PublicLayout
    title="Productos"
    description="Explora toda nuestra colecciÃ³n de merch de artistas"
>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1
                class="text-3xl lg:text-4xl font-serif font-bold text-[#2a2622]"
            >
                Todos los Productos
            </h1>
            <p class="mt-2 text-[#6f6458]">
                {allProducts.length} productos disponibles
            </p>
        </div>

        <!-- Filters and Products (React Island) -->
        <ProductFilters
            client:load
            products={allProducts}
            categories={allCategories}
        />
    </div>
</PublicLayout>
