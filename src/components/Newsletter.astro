---
// Newsletter Subscription Component - Origin Style
---

<div class="newsletter-section bg-cream-100 py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div
            class="flex flex-col md:flex-row items-center justify-between gap-8"
        >
            <div class="text-center md:text-left">
                <h3
                    class="text-2xl md:text-3xl font-serif italic text-[#2a2622] mb-3"
                >
                    √önete a nuestra Newsletter
                </h3>
                <p class="text-[#6f6458] max-w-md">
                    Recibe ofertas exclusivas, novedades y un <strong
                        class="text-[#8B4513] font-medium"
                        >10% de descuento</strong
                    > en tu primera compra
                </p>
            </div>

            <form
                id="newsletter-form"
                class="flex flex-col sm:flex-row gap-3 w-full md:w-auto"
            >
                <div class="relative">
                    <input
                        type="email"
                        id="newsletter-email"
                        name="email"
                        placeholder="Tu email..."
                        required
                        class="px-6 py-4 bg-[#fdfcf9] border border-[#ccc5b8] text-[#2a2622]
                               placeholder-[#ada397] focus:outline-none focus:border-[#2a2622]
                               w-full sm:w-80 transition-all duration-300"
                    />
                </div>
                <button
                    type="submit"
                    id="newsletter-btn"
                    class="px-8 py-4 bg-[#2a2622] text-[#fdfcf9] text-xs tracking-wider uppercase font-medium
                           hover:bg-[#3d3831] transition-all duration-300
                           flex items-center justify-center gap-2 group"
                >
                    <span>Suscribirme</span>
                    <svg
                        class="w-5 h-5 group-hover:translate-x-1 transition-transform duration-300"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                    </svg>
                </button>
            </form>
        </div>

        <!-- Toast container for this component -->
        <div
            id="newsletter-toast"
            class="hidden mt-4 p-4 rounded-xl text-center transition-all backdrop-blur-sm"
        >
        </div>
    </div>
</div>

<script>
    const form = document.getElementById("newsletter-form");
    const emailInput = document.getElementById(
        "newsletter-email",
    ) as HTMLInputElement;
    const btn = document.getElementById("newsletter-btn");
    const toast = document.getElementById("newsletter-toast");

    function showNewsletterToast(message: string, isSuccess: boolean) {
        if (!toast) return;

        toast.className = `mt-4 p-4 rounded-lg text-center transition-all ${
            isSuccess
                ? "bg-green-500/20 text-green-200 border border-green-500/30"
                : "bg-red-500/20 text-red-200 border border-red-500/30"
        }`;
        toast.textContent = message;
        toast.classList.remove("hidden");

        setTimeout(() => {
            toast.classList.add("hidden");
        }, 5000);
    }

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = emailInput?.value;
        if (!email) return;

        const button = btn as HTMLButtonElement;
        const originalText = button.innerHTML;
        button.disabled = true;
        button.innerHTML = `
            <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Procesando...</span>
        `;

        try {
            const response = await fetch("/api/newsletter", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, source: "footer" }),
            });

            const data = await response.json();

            if (data.success) {
                showNewsletterToast(
                    "üéâ ¬°Suscripci√≥n completada! Revisa tu email para tu c√≥digo de descuento.",
                    true,
                );
                emailInput.value = "";
            } else {
                showNewsletterToast(
                    "‚ùå " + (data.error || "Error al procesar la suscripci√≥n"),
                    false,
                );
            }
        } catch (error) {
            showNewsletterToast(
                "‚ùå Error de conexi√≥n. Int√©ntalo de nuevo.",
                false,
            );
        } finally {
            button.disabled = false;
            button.innerHTML = originalText;
        }
    });
</script>
